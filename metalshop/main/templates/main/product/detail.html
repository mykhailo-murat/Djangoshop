{% extends 'main/base.html' %}
{% load static %}

{% block title %}
    {{ product.name }}
{% endblock %}

{% block content %}
    <section class="product d-flex gap-4 pt-4">

        <div class="product__images">
            {% if product.images.all|length > 1 %}
                {% for image in product.images.all %}
                    <img class="product__images-item" src="{{ image.image.url }}" alt="" style="display: none"
                         data-index="{{ forloop.counter0 }}">
                {% endfor %}
            {% else %}
                <img class="product__images-item" src="{{ product.image.url }}" alt="">
            {% endif %}

            <div class="product__image-nav">
                <button class="prev-bnt">&lsaquo;</button>
                <button class="next-bnt">&rsaquo;</button>
            </div>
            <script>
                const images = document.querySelectorAll('.product__images-item');
                const prev_btn = document.querySelector('.prev-bnt');
                const next_btn = document.querySelector('.next-bnt');
                let currentIndex = 0;
                images[currentIndex].style.display = 'block';
                if (images.length === 1) {
                    prev_btn.style.display = 'none'
                    next_btn.style.display = 'none'
                } else {
                    prev_btn.addEventListener('click', () => {
                        images[currentIndex].style.display = 'none';
                        currentIndex = (currentIndex - 1 + images.length) % images.length;
                        images[currentIndex].style.display = 'block'
                    })
                    next_btn.addEventListener('click', () => {
                        images[currentIndex].style.display = 'none';
                        currentIndex = (currentIndex + 1) % images.length;
                        images[currentIndex].style.display = 'block'
                    })
                }
            </script>

        </div>
        <div class="product__info">
            <h2>{{ product.name }}</h2>
            <h3>{{ product.category }}</h3>
            <p>{{ product.description |linebreaks }}</p>
            {% if product.discount %}
                <div class="discount d-flex gap-4 align-items-center">
                    <p class="through">{{ product.price }}</p>
                    <p class="price">{{ product.sell_price }}</p>
                </div>
            {% else %}
                <p class="price">{{ product.price }}</p>
            {% endif %}

            <form action="{% url 'cart:cart_add' product.id %}" method="post" class="product__add-to-cart">
                {{ cart_product_form }}
                {% csrf_token %}
                <input type="submit" class="add-to-cart-btn btn button mt-4" value="Add to Cart">
            </form>
        </div>
    </section>
{% endblock %}